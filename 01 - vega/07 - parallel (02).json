{
    "layer": [
      {
        "mark": {
          "type": "rule",
          "color": "#ccc"
        },
        "encoding": {
          "x": {
            "field": "key",
            "type": "nominal"
          },
          "detail": {
            "type": "quantitative",
            "aggregate": "count"
          }
        }
      },
      {
        "mark": {
          "type": "line"
        },
        "encoding": {
          "x": {
            "field": "key",
            "type": "nominal"
          },
          "detail": {
            "field": "index",
            "type": "nominal"
          },
          "color": {
            "field": "Species",
            "type": "nominal"
          },
          "opacity": {
            "condition": {
              "test": {
                "selection": "sel2"
              },
              "value": 1
            },
            "value": 0.3
          },
          "y": {
            "field": "norm_val",
            "type": "quantitative",
            "axis": null
          },
          "tooltip": [
            {
              "field": "Beak Length (mm)",
              "type": "nominal"
            },
            {
              "field": "Beak Depth (mm)",
              "type": "nominal"
            },
            {
              "field": "Flipper Length (mm)",
              "type": "nominal"
            },
            {
              "field": "Body Mass (g)",
              "type": "nominal"
            }
          ]
        }
      },
      {
        "mark": {
          "type": "circle"
        },
        "encoding": {
          "x": {
            "field": "key",
            "type": "nominal"
          },
          "detail": {
            "field": "index",
            "type": "nominal"
          },
          "color": {
            "field": "Species",
            "type": "nominal"
          },
          "opacity": {
            "condition": {
              "test": {
                "selection": "sel2"
              },
              "value": 1
            },
            "value": 0.3
          },
          "y": {
            "field": "norm_val",
            "type": "quantitative",
            "axis": null
          },
          "tooltip": [
            {
              "field": "Beak Length (mm)",
              "type": "nominal"
            },
            {
              "field": "Beak Depth (mm)",
              "type": "nominal"
            },
            {
              "field": "Flipper Length (mm)",
              "type": "nominal"
            },
            {
              "field": "Body Mass (g)",
              "type": "nominal"
            }
          ],
          "size": {
            "condition": {
              "test": {
                "selection": "sel2"
              },
              "value": 50
            },
            "value": 5
          }
        },
        "selection": {
          "sel2": {
            "type": "single",
            "on": "mouseover",
            "nearest": true,
            "empty": "none"
          }
        }
      },
      {
        "layer": [
          {
            "mark": {
              "type": "text",
              "style": "label"
            },
            "encoding": {
              "x": {
                "field": "key",
                "type": "nominal"
              },
              "detail": {
                "type": "quantitative",
                "aggregate": "count"
              },
              "text": {
                "field": "max",
                "type": "quantitative",
                "aggregate": "max"
              }
            }
          },
          {
            "mark": {
              "type": "tick",
              "style": "tick",
              "size": 8,
              "color": "#ccc"
            },
            "encoding": {
              "x": {
                "field": "key",
                "type": "nominal"
              },
              "detail": {
                "type": "quantitative",
                "aggregate": "count"
              }
            }
          }
        ],
        "encoding": {
          "y": {
            "value": 0
          }
        }
      },
      {
        "layer": [
          {
            "mark": {
              "type": "text",
              "style": "label"
            },
            "encoding": {
              "x": {
                "field": "key",
                "type": "nominal"
              },
              "detail": {
                "type": "quantitative",
                "aggregate": "count"
              },
              "text": {
                "field": "max",
                "type": "quantitative",
                "aggregate": "max"
              }
            }
          },
          {
            "mark": {
              "type": "tick",
              "style": "tick",
              "size": 8,
              "color": "#ccc"
            },
            "encoding": {
              "x": {
                "field": "key",
                "type": "nominal"
              },
              "detail": {
                "type": "quantitative",
                "aggregate": "count"
              }
            }
          }
        ],
        "encoding": {
          "y": {
            "value": 200
          }
        }
      },
      {
        "layer": [
          {
            "mark": {
              "type": "text",
              "style": "label"
            },
            "encoding": {
              "x": {
                "field": "key",
                "type": "nominal"
              },
              "detail": {
                "type": "quantitative",
                "aggregate": "count"
              },
              "text": {
                "field": "max",
                "type": "quantitative",
                "aggregate": "max"
              }
            }
          },
          {
            "mark": {
              "type": "tick",
              "style": "tick",
              "size": 8,
              "color": "#ccc"
            },
            "encoding": {
              "x": {
                "field": "key",
                "type": "nominal"
              },
              "detail": {
                "type": "quantitative",
                "aggregate": "count"
              }
            }
          }
        ],
        "encoding": {
          "y": {
            "value": 400
          }
        }
      }
    ],
    "data": {"url": "05 - data.json"},
    "transform": [
      {
        "filter": "datum[\"Beak Length (mm)\"] != null && datum[\"Beak Depth (mm)\"] != null && datum[\"Flipper Length (mm)\"] != null && datum[\"Body Mass (g)\"] != null"
      },
      {
        "window": [
          {
            "op": "count",
            "as": "index"
          }
        ]
      },
      {
        "fold": [
          "Beak Length (mm)",
          "Beak Depth (mm)",
          "Flipper Length (mm)",
          "Body Mass (g)"
        ]
      },
      {
        "joinaggregate": [
          {
            "op": "min",
            "field": "value",
            "as": "min"
          },
          {
            "op": "max",
            "field": "value",
            "as": "max"
          }
        ],
        "groupby": [
          "key"
        ]
      },
      {
        "calculate": "(datum.value - datum.min) / (datum.max - datum.min)",
        "as": "norm_val"
      },
      {
        "calculate": "(datum.min + datum.max) / 2",
        "as": "mid"
      }
    ],
    "config": {
      "axisX": {
        "domain": false,
        "labelAngle": 0,
        "tickColor": "#ccc",
        "title": null
      },
      "view": {
        "stroke": null
      },
      "style": {
        "label": {
          "baseline": "middle",
          "align": "right",
          "dx": -5
        },
        "tick": {
          "orient": "horizontal"
        }
      }
    },
    "width": 700,
    "height": 400
  }